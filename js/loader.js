(function(){"use strict";const s="1.3.0",c="satura_app_version";let o=null,d=null,r=null,u=0;const l=[{src:"js/app.min.js",name:"Aplikasi"}];function g(){o=document.getElementById("splashScreen"),d=document.getElementById("splashProgressBar"),r=document.getElementById("splashStatus"),document.body.classList.add("splash-active")}function a(e,t){d&&(d.style.width=Math.min(e,100)+"%"),r&&t&&(r.textContent=t)}function p(){o&&(o.classList.add("splash--hidden"),document.body.classList.remove("splash-active"),setTimeout(()=>{o&&o.parentNode&&o.parentNode.removeChild(o)},500))}function y(e,t){return new Promise((n,L)=>{const i=document.createElement("script");i.src=e.src,i.async=!1,i.onload=()=>{u++;const v=u/l.length*80;a(v,`Memuat ${e.name}...`),n()},i.onerror=()=>L(new Error(`Failed to load: ${e.src}`)),document.head.appendChild(i)})}async function S(){a(5,"Memulai...");for(let e=0;e<l.length;e++)try{await y(l[e],e)}catch(t){throw console.error("[Loader] Error loading module:",t),t}}function m(){try{const e=localStorage.getItem(c);return e&&e!==s?(a(5,"Memperbarui cache..."),"caches"in window&&caches.keys().then(t=>{t.forEach(n=>{n.startsWith("satura-")&&caches.delete(n)})}),localStorage.setItem(c,s),window.location.reload(!0),!0):(e||localStorage.setItem(c,s),!1)}catch(e){return console.error("[Loader] Version check failed:",e),!1}}function h(){navigator.onLine&&"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(e=>{e&&e.update()})}function w(){h(),m()}function E(){return new Promise((e,t)=>{a(85,"Menyiapkan data..."),typeof SaturaApp<"u"&&SaturaApp.on?(SaturaApp.on("onReady",()=>{a(100,"Selesai!"),setTimeout(e,300)}),SaturaApp.on("onPrayerTimesFetched",()=>{a(95,"Hampir selesai...")}),SaturaApp.on("onError",n=>{console.error("[Loader] App reported error:",n),a(100,"Memuat dengan peringatan..."),setTimeout(()=>t(n),500)})):(a(100,"Selesai!"),setTimeout(e,500))})}async function f(){if(g(),!m()){window.addEventListener("online",w),setInterval(()=>{navigator.onLine&&h()},300*1e3);try{await S(),await E(),p()}catch(e){if(console.error("[Loader] Failed to load:",e),a(0,"Gagal memuat aplikasi"),r){r.textContent="";const t=document.createElement("span");t.style.color="#ff6b6b",t.textContent="Gagal memuat aplikasi",r.appendChild(t),r.appendChild(document.createElement("br"));const n=document.createElement("button");n.textContent="Coba Lagi",n.style.cssText="margin-top: 1rem; padding: 0.5rem 1rem; background: var(--clr-accent-500); border: none; border-radius: 8px; color: white; cursor: pointer;",n.addEventListener("click",()=>location.reload()),r.appendChild(n)}}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f(),window.SaturaLoader={hideSplash:p,updateProgress:a}})();
