const CACHE_VERSION="v25-dist",CACHE_NAMES={static:`satura-static-${CACHE_VERSION}`,api:`satura-api-${CACHE_VERSION}`,database:`satura-db-${CACHE_VERSION}`},STATIC_ASSETS=["/saturamadhan/dist/","/saturamadhan/dist/index.html","/saturamadhan/dist/manifest.json","/saturamadhan/dist/css/style.min.css","/saturamadhan/dist/assets/vendor/boxicons/css/boxicons.min.css","/saturamadhan/dist/assets/icon/cloud-sun.svg","/saturamadhan/dist/assets/icon/moon-stars.svg","/saturamadhan/dist/assets/icon/moon.svg","/saturamadhan/dist/assets/icon/sun-fog.svg","/saturamadhan/dist/assets/icon/sun-rise.svg","/saturamadhan/dist/assets/icon/sun-set.svg","/saturamadhan/dist/assets/icon/sun.svg","/saturamadhan/dist/assets/font/poppins/Poppins-Light.ttf","/saturamadhan/dist/assets/font/poppins/Poppins-Regular.ttf","/saturamadhan/dist/assets/font/poppins/Poppins-Medium.ttf","/saturamadhan/dist/assets/font/poppins/Poppins-SemiBold.ttf","/saturamadhan/dist/assets/font/poppins/Poppins-Bold.ttf","/saturamadhan/dist/assets/font/amiri/Amiri-Regular.ttf","/saturamadhan/dist/assets/font/amiri/Amiri-Bold.ttf","/saturamadhan/dist/assets/vendor/boxicons/fonts/boxicons.woff2","/saturamadhan/dist/assets/vendor/boxicons/fonts/boxicons.woff","/saturamadhan/dist/assets/vendor/boxicons/fonts/boxicons.ttf","/saturamadhan/dist/js/loader.js","/saturamadhan/dist/js/app.min.js"],JS_FILES_PATTERN=/\.js$/,DATABASE_ASSETS=["/saturamadhan/dist/database/province.json","/saturamadhan/dist/database/regency.json","/saturamadhan/dist/database/ramadhan.json"],API_DOMAINS=["api.aladhan.com","aladhan.api.islamic.network","aladhan.api.alislam.ru"];self.addEventListener("install",a=>{console.log("[SW] Installing Service Worker..."),a.waitUntil(Promise.all([caches.open(CACHE_NAMES.static).then(s=>(console.log("[SW] Caching static assets"),s.addAll(STATIC_ASSETS))),caches.open(CACHE_NAMES.database).then(s=>(console.log("[SW] Caching database assets"),s.addAll(DATABASE_ASSETS)))]).then(()=>(console.log("[SW] Installation complete"),self.skipWaiting())))}),self.addEventListener("activate",a=>{console.log("[SW] Activating Service Worker..."),a.waitUntil(caches.keys().then(s=>Promise.all(s.filter(t=>t.startsWith("satura-")&&!Object.values(CACHE_NAMES).includes(t)).map(t=>(console.log("[SW] Deleting old cache:",t),caches.delete(t))))).then(()=>(console.log("[SW] Activation complete"),self.clients.claim())))}),self.addEventListener("fetch",a=>{const s=a.request,t=new URL(s.url);s.method==="GET"&&(isApiRequest(t)?a.respondWith(staleWhileRevalidateStrategy(s,CACHE_NAMES.api,t)):isDatabaseRequest(t)?a.respondWith(cacheFirstStrategy(s,CACHE_NAMES.database)):isJavaScriptFile(t)||isHtmlFile(t)?a.respondWith(networkFirstStrategy(s,CACHE_NAMES.static)):isStaticAsset(t)?a.respondWith(cacheFirstStrategy(s,CACHE_NAMES.static)):a.respondWith(networkFirstStrategy(s,CACHE_NAMES.static)))});function isJavaScriptFile(a){return JS_FILES_PATTERN.test(a.pathname)}function isHtmlFile(a){return a.pathname.endsWith(".html")||a.pathname==="/"||a.pathname.endsWith("/")}async function cacheFirstStrategy(a,s){try{const t=await caches.match(a);if(t)return console.log("[SW] Cache hit:",a.url),t;console.log("[SW] Cache miss, fetching:",a.url);const e=await fetch(a);return e.ok&&(await caches.open(s)).put(a,e.clone()),e}catch(t){console.error("[SW] Cache-first fetch failed:",t);const e=await caches.match(a);if(e)return e;if(a.mode==="navigate")return caches.match("/saturamadhan/dist/index.html");throw t}}async function networkFirstStrategy(a,s){try{console.log("[SW] Network request:",a.url);const t=await fetch(a);return t.ok&&(await caches.open(s)).put(a,t.clone()),t}catch(t){console.log("[SW] Network failed, checking cache:",a.url);const e=await caches.match(a);if(e)return console.log("[SW] Returning cached response"),e;if(console.error("[SW] No cached response available"),isApiRequest(new URL(a.url)))return new Response(JSON.stringify({code:503,status:"Service Unavailable",message:"Anda sedang offline dan data tidak tersedia dalam cache"}),{status:503,headers:{"Content-Type":"application/json"}});throw t}}function normalizeApiUrl(a){const s=new URL(a.toString());return["latitude","longitude"].forEach(t=>{if(s.searchParams.has(t)){const e=Number(s.searchParams.get(t));isNaN(e)||s.searchParams.set(t,e.toFixed(4))}}),s.toString()}async function staleWhileRevalidateStrategy(a,s,t=null){const e=await caches.open(s);let n=a;if(t&&isApiRequest(t)){const o=normalizeApiUrl(t);n=new Request(o,{method:a.method,headers:a.headers})}const i=await e.match(n),c=fetch(a).then(o=>(o.ok&&e.put(n,o.clone()),o)).catch(()=>i);return i||c}function isApiRequest(a){return API_DOMAINS.some(s=>a.hostname.includes(s))}function isDatabaseRequest(a){return a.pathname.includes("/database/")&&a.pathname.endsWith(".json")}function isStaticAsset(a){return[".html",".css",".js",".json",".png",".jpg",".jpeg",".gif",".svg",".ico",".woff",".woff2",".ttf"].some(t=>a.pathname.endsWith(t))}self.addEventListener("sync",a=>{console.log("[SW] Background sync:",a.tag),a.tag==="sync-prayer-times"&&a.waitUntil(syncPrayerTimes())});async function syncPrayerTimes(){try{console.log("[SW] Syncing prayer times...")}catch(a){console.error("[SW] Sync failed:",a)}}self.addEventListener("push",a=>{if(console.log("[SW] Push received:",a),!a.data)return;const s=a.data.json(),t={body:s.body||"Waktu sholat telah tiba",icon:"/saturamadhan/dist/assets/favicon/favicon.png",badge:"/saturamadhan/dist/assets/favicon/favicon.png",vibrate:[100,50,100],data:s,actions:[{action:"open",title:"Buka Aplikasi"},{action:"close",title:"Tutup"}]};a.waitUntil(self.registration.showNotification(s.title||"Satu Ramadhan",t))}),self.addEventListener("notificationclick",a=>{console.log("[SW] Notification clicked:",a.action),a.notification.close(),(a.action==="open"||!a.action)&&a.waitUntil(clients.matchAll({type:"window"}).then(s=>{for(const t of s)if(t.url.includes("saturamadhan")&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow("/saturamadhan/dist/")}))}),self.addEventListener("message",a=>{console.log("[SW] Message received:",a.data);const{type:s,payload:t}=a.data;switch(s){case"SKIP_WAITING":self.skipWaiting();break;case"CACHE_PRAYER_TIMES":cachePrayerTimesData(t);break;case"CLEAR_CACHE":clearAllCaches();break;case"GET_CACHE_STATUS":getCacheStatus().then(e=>{a.ports[0].postMessage(e)});break;default:console.log("[SW] Unknown message type:",s)}});async function cachePrayerTimesData(a){try{const s=await caches.open(CACHE_NAMES.api),t=a.url||`prayer-times-${a.date}`,e=new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}});await s.put(t,e),console.log("[SW] Prayer times cached for:",a.date)}catch(s){console.error("[SW] Failed to cache prayer times:",s)}}async function clearAllCaches(){const a=await caches.keys();await Promise.all(a.filter(s=>s.startsWith("satura-")).map(s=>caches.delete(s))),console.log("[SW] All caches cleared")}async function getCacheStatus(){const a=await caches.keys(),s={};for(const t of a)if(t.startsWith("satura-")){const n=await(await caches.open(t)).keys();s[t]={count:n.length,urls:n.map(i=>i.url)}}return s}console.log("[SW] Service Worker loaded");
